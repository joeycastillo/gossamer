<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>gossamer: System Internals</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">gossamer<span id="projectnumber">&#160;0.0.1</span>
   </div>
   <div id="projectbrief">a very lightweight app framework for SAMD and SAML chips</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group__system.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">System Internals</div></div>
</div><!--header-->
<div class="contents">

<p>Functions for configuring the system and putting it in standby mode.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaf411a8bc6b7ed4b0af9114e10c959448" id="r_gaf411a8bc6b7ed4b0af9114e10c959448"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaf411a8bc6b7ed4b0af9114e10c959448">sys_init</a> (void)</td></tr>
<tr class="memdesc:gaf411a8bc6b7ed4b0af9114e10c959448"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the system clocks and performs any required system-wide setup.  <br /></td></tr>
<tr class="separator:gaf411a8bc6b7ed4b0af9114e10c959448"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga96fa401b65736262fc29cc0537bed03e" id="r_ga96fa401b65736262fc29cc0537bed03e"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga96fa401b65736262fc29cc0537bed03e">get_cpu_frequency</a> (void)</td></tr>
<tr class="memdesc:ga96fa401b65736262fc29cc0537bed03e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the CPU frequency.  <br /></td></tr>
<tr class="separator:ga96fa401b65736262fc29cc0537bed03e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4f33e5a16dba970fa7064ea27287fcba" id="r_ga4f33e5a16dba970fa7064ea27287fcba"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga4f33e5a16dba970fa7064ea27287fcba">set_cpu_frequency</a> (uint32_t freq)</td></tr>
<tr class="memdesc:ga4f33e5a16dba970fa7064ea27287fcba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the CPU frequency.  <br /></td></tr>
<tr class="separator:ga4f33e5a16dba970fa7064ea27287fcba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf6d6cb9ca08e26e456d9ed1d425453e8" id="r_gaf6d6cb9ca08e26e456d9ed1d425453e8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaf6d6cb9ca08e26e456d9ed1d425453e8">_enable_48mhz_gclk1</a> (void)</td></tr>
<tr class="memdesc:gaf6d6cb9ca08e26e456d9ed1d425453e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enables the 48 MHz clock on GCLK1 for USB operation.  <br /></td></tr>
<tr class="separator:gaf6d6cb9ca08e26e456d9ed1d425453e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga436af75ad5caf82faa3497787abf4321" id="r_ga436af75ad5caf82faa3497787abf4321"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga436af75ad5caf82faa3497787abf4321">_enter_standby_mode</a> (void)</td></tr>
<tr class="memdesc:ga436af75ad5caf82faa3497787abf4321"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enters the low-power STANDBY mode. Does not return until an interrupt fires.  <br /></td></tr>
<tr class="separator:ga436af75ad5caf82faa3497787abf4321"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Functions for configuring the system and putting it in standby mode. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="gaf6d6cb9ca08e26e456d9ed1d425453e8" name="gaf6d6cb9ca08e26e456d9ed1d425453e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf6d6cb9ca08e26e456d9ed1d425453e8">&#9670;&#160;</a></span>_enable_48mhz_gclk1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void _enable_48mhz_gclk1 </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enables the 48 MHz clock on GCLK1 for USB operation. </p>
<p>This function is called by the USB stack when it is initialized. </p><dl class="section warning"><dt>Warning</dt><dd>At this time, the 48 MHz clock is hard-coded to use USB Clock Recovery Mode, and as such will only be available if your device is plugged into a USB host. It is possible to derive the 48 MHz DFLL from an external 32kHz crystal, but this is not currently implemented in Gossamer. </dd></dl>

</div>
</div>
<a id="ga436af75ad5caf82faa3497787abf4321" name="ga436af75ad5caf82faa3497787abf4321"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga436af75ad5caf82faa3497787abf4321">&#9670;&#160;</a></span>_enter_standby_mode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void _enter_standby_mode </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enters the low-power STANDBY mode. Does not return until an interrupt fires. </p>
<p>You should not generally need to call this function; at the end of every app_loop invocation, the main run loop enters standby mode if your app indicated that it was appropriate. </p>

</div>
</div>
<a id="ga96fa401b65736262fc29cc0537bed03e" name="ga96fa401b65736262fc29cc0537bed03e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga96fa401b65736262fc29cc0537bed03e">&#9670;&#160;</a></span>get_cpu_frequency()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t get_cpu_frequency </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gets the CPU frequency. </p>
<dl class="section return"><dt>Returns</dt><dd>8000000 by default, or another value if set by <code>set_cpu_frequency</code> </dd></dl>

</div>
</div>
<a id="ga4f33e5a16dba970fa7064ea27287fcba" name="ga4f33e5a16dba970fa7064ea27287fcba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4f33e5a16dba970fa7064ea27287fcba">&#9670;&#160;</a></span>set_cpu_frequency()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool set_cpu_frequency </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>freq</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the CPU frequency. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">freq</td><td>one of 1000000, 2000000, 4000000, 8000000, 12000000 or 16000000.</td></tr>
  </table>
  </dd>
</dl>
<p>Supported CPU frequencies vary from chip to chip:</p><ul>
<li>On the SAM D11 and D21, you can choose 8, 4, 2 or 1 MHz.</li>
<li>On the SAM L21 and L22, you can choose 16, 12, 8 or 4 MHz. While you can run these chips at higher frequencies using the DFLL, Gossamer aims for simplicity: this means that it only supports the internal oscillator at one of its standard frequencies. <dl class="section note"><dt>Note</dt><dd>Some peripherals like SERCOMs and TC/TCCs read the CPU frequency when they are configured, to set critical timing-related parameters like baud rate or period. If you change the CPU frequency after setting up these peripherals and then attempt to use them, they will very likely behave in unexpected ways. Thus you should de-init any peripherals that depend on GCLK0 before calling set_cpu_frequency, and then re-init them after. </dd></dl>
</li>
</ul>

</div>
</div>
<a id="gaf411a8bc6b7ed4b0af9114e10c959448" name="gaf411a8bc6b7ed4b0af9114e10c959448"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf411a8bc6b7ed4b0af9114e10c959448">&#9670;&#160;</a></span>sys_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sys_init </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the system clocks and performs any required system-wide setup. </p>
<p>Gossamer aims for consistency at system startup, no matter which chip you are working with. To that end:</p><ul>
<li>GCLK0, the main system clock, is set to 8 MHz.</li>
<li>GCLK2 is the low-power 32768 Hz clock, OSCULP32K</li>
<li>GCLK3 is a 1024 Hz clock, derived from the most accurate source available. GCLK0 is set to ONDEMAND with RUNSTDBY off, so the main clock remains off when in standby mode. GCLK2 and GCLK3 are also ONDEMAND, but RUNSTDBY is on. This ensures that if a peripheral requests it, the clock will remain on in standby, but if no peripheral requests it, it will not run at all. Also note that while GCLK1 is not turned on at startup, it may be reserved for internal use depending on your use case. If you intend to use USB, the <code>usb_init</code> function will claim GCLK1 for the 48 MHz DFLL clock. </li>
</ul>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
